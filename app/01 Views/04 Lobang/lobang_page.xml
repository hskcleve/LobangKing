<Page id="lobang_page" loaded="onLoaded" navigatedTo="onNavigatedTo"
    xmlns:df="nativescript-ui-dataform"
    xmlns:customUI="~/04 Custom UI">
    <GridLayout class="gradientBg" rows="auto,auto,*,auto">
        <GridLayout class="topBar" row="0" columns="40,*">
            <Image col="0" src="~/06 Assets/00 General/back_arrow.png" height="20" tap="goBack"/>
            <Label col="1" class="h1" text="Profile" tap="goBack"/>
        </GridLayout>

        <GridLayout class="lobangInfoContainer" row="1" columns="*,2*" height="30%" >
            <GridLayout style="{{lobang.getBackgroundImageCss()}}" >
            </GridLayout>
            <StackLayout>
                <Label class="h2-large" text="{{lobang.lobang_name}}"/>
                <Label class="fineprint" text="{{getNumUsersJoined() + ' people joined'}}"/>
                <GridLayout style="padding:10%" rows="auto,2,auto,2,auto" columns="*,*" >
                    <Image class="iconPic" row="0" col="0" src="~/06 Assets/10 Lobang Icons/products.png" height="30"/>
                    <Label class="fineprint" row="0" col="1" text="{{ getNumProducts() }}"/>
                    <Image class="iconPic" row="2" col="0" src="~/06 Assets/10 Lobang Icons/tag.png" height="30"/>
                    <Label class="fineprint" row="2" col="1" text="{{getTags()}}"/>
                    <Image class="iconPic" row="4" col="0" src="~/06 Assets/10 Lobang Icons/time-left.png" height="30"/>
                    <Label class="fineprint" row="4" col="1" text="{{getTimeLeft()}}"/>
                </GridLayout>
            </StackLayout>
        </GridLayout>

        <GridLayout class="lobangTabContainer" row="2" rows="60%, *" columns="5,*,5,*,5,*,5">
            <GridLayout row="0" col="1" class="{{tab == 'lobangDetails' ? 'tabHeaderSelected' : 'tabHeaderUnselected'}}" tap="toggleLobangDetailsTab">
                <Image src="~/06 Assets/10 Lobang Icons/Details.png" height="75"/>
            </GridLayout>
            <GridLayout row="0" col="3" class="{{tab == 'lobangAnnouncements' ? 'tabHeaderSelected' : 'tabHeaderUnselected'}}" tap="toggleLobangAnnouncementsTab">
                <Image src="~/06 Assets/10 Lobang Icons/Announcements.png" height="75"/>
            </GridLayout>
            <GridLayout row="0" col="5" class="{{tab == 'lobangProducts' ? 'tabHeaderSelected' : 'tabHeaderUnselected'}}" tap="toggleLobangProductsTab">
                <Image src="~/06 Assets/10 Lobang Icons/Product.png" height="75"/>
            </GridLayout>

            <ScrollView hidden="{{tab!='lobangDetails'}}" row="1" colSpan="7" orientation="vertical" scrollBarIndicatorVisible="false">
                <StackLayout style="padding:10%">
                    <GridLayout class="hostInfoContainer" row="1" columns="5,*,2*" height="22%">
                        <Label col="0" class="h2-large" text="Hosted by" />
                        <GridLayout col="1">
                            <GridLayout class="profileInfoContainer" row="1" columns="*,2*" height="22%">
                                <StackLayout col="0" height="100%">
                                    <GridLayout class="profilePicContainer">
                                        <Image class="profilePic" src="{{lobang_host.profile_pic_uri}}" stretch="aspectFill"></Image>
                                    </GridLayout>
                                    <Label class="h2-large" text="{{lobang_host.first_name + ' ' + lobang_host.last_name}}"/>
                                    <Label class="fineprint" text="{{'@' + lobang_host.user_id}}"/>
                                </StackLayout>
                                <StackLayout col="1">
                                    <GridLayout style="padding:10%" rows="auto,auto" columns="*,*,*" height="55%">
                                        <Label class="h2-large" row="0" col="0" text="{{lobang_host.date_joined | displayDateJoined}}"/>
                                        <Label class="h2-large" row="0" col="1" text="{{lobang_host.getRating()}}"/>
                                        <Label class="h2-large" row="0" col="2" text="{{lobang_host.coins}}"/>
                                        <Label class="fineprint" row="1" col="0" text="Joined"/>
                                        <Label class="fineprint" row="1" col="1" text="Rating"/>
                                        <Label class="fineprint" row="1" col="2" text="Lobang Coins"/>
                                    </GridLayout>
                                    <GridLayout columns="*,auto,auto,10,auto,auto,*" height="15%">
                                        <Image col="1" height="12" src="{{lobang_host.verified | getVerifiedIcon}}" style="margin-bottom:3"/>
                                        <Label class="fineprint" col="2" text="{{lobang_host.getVerifiedStatusString()}}" style="margin-left:2"/>
                                        <Image col="4" height="12" src="~/06 Assets/06 Profile Page Icons/location-pin.png" style="margin-bottom:3"/>
                                        <Label class="fineprint" col="5" text="{{lobang_host.location}}" style="margin-left:2"/>
                                    </GridLayout>
                                </StackLayout>
                            </GridLayout>
                        </GridLayout>
                    </GridLayout>

                    <GridLayout class="collectionPointContainer" row="1" columns="*,2*" height="22%">
                        <Label class="h2-large" col="0" text="Collection Point" />
                        <Label class="fineprint" col="1" text="{{location}}" />
                    </GridLayout>

                    <GridLayout class="collectionDatetimeContainer" row="1" columns="*,2*" height="22%">
                        <Label class="h2-large" col="0" text="Collection Date, Time" />
                        <Label class="fineprint" col="1" text="{{collection_date}}" />
                    </GridLayout>
                </StackLayout>
            </ScrollView>
            
            <ScrollView hidden="{{tab!='lobangAnnouncements'}}"  row="1" colSpan="7" orientation="vertical" scrollBarIndicatorVisible="false">
                <StackLayout style="padding:10%">
                    <Repeater items="{{announcements}}">
                        <Repeater.itemsLayout>
                            <StackLayout orientation="vertical"/>
                        </Repeater.itemsLayout>
                        <Repeater.itemTemplate>
                            <StackLayout>
                                <GridLayout class="announcementPanel" >
                                    <GridLayout rows="*,*,*" columns="3, 3, 3, auto" style="padding:10%">
                                        <GridLayout class="announcementProfilePicContainer" row="0" col="0" >
                                            <Image class="announcementProfilePic" src="{{lobang_host.profile_pic_uri}}" stretch="aspectFill" />
                                        </GridLayout>
                                        <Label class="h2-large" row="0" col="1" text="{{lobang_host.first_name + ' ' + lobang_host.last_name}}"/>
                                        <Label class="fineprint" row="0" col="2" text="{{'@' + lobang_host.user_id}}"/>
                                        <Label class="fineprint" row="0" col="3" text="{{announcement.date}}"/>
                                        <Label class="h2-large" row="1" colSpan="4" text="{{announcement.description}}"/>
                                        <GridLayout class="announcementPicContainer" row="2" colSpan="4">
                                            <Image class="announcementPic" src="{{announcement.pic}}" stretch="aspectFill" />
                                        </GridLayout>
                                    </GridLayout>
                                </GridLayout>
                            </StackLayout>
                        </Repeater.itemTemplate> 
                    </Repeater>   
                </StackLayout>
            </ScrollView>

            <ScrollView hidden="{{tab!='lobangOrders'}}"  row="1" colSpan="7" orientation="vertical" scrollBarIndicatorVisible="false">
                <StackLayout hidden ="{{lobang_host.hasOrder(lobang) != true}}" style="padding:10%" >
                    <Label class="h2-large" text="{{ 'Products (' + products.length + ')' }}"/>
                    <StackLayout style="padding:10%" >
                        <Repeater items="{{products}}">
                            <Repeater.itemsLayout>
                                <StackLayout orientation="vertical"/>
                            </Repeater.itemsLayout>
                            <Repeater.itemTemplate>
                                <StackLayout>
                                    <GridLayout class="productPanel">
                                        <GridLayout rows="*,*" columns="3,auto" style="padding:10%">
                                            <Label class="h2-large" row="0" colSpan="2" text="{{product.name + ' (' + product.unit_qty +')'}}"/>
                                            <Label class="fineprint" row="1" col="0" text="{{ '$' + product.price}}"/>
                                            <Label class="fineprint" row="1" col="1" text="1"/>
                                        </GridLayout>
                                    </GridLayout>
                                </StackLayout>
                            </Repeater.itemTemplate> 
                        </Repeater>   
                    </StackLayout>
                </StackLayout>
            </ScrollView>
        </GridLayout>
        <customUI:navbar row="3"/>
    </GridLayout>
</Page>
